import telebot, json, copy
with open('token_15gr.txt') as f:
    TOKEN = f.read()
bot = telebot.TeleBot(TOKEN)
# {‚Äò–ª–æ–∫–∞—Ü–∏—è‚Äô : {
# ‚Äòtext‚Äô : ‚Äò—Ç–µ–∫—Å—Ç–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ‚Äô, 
# ‚Äòitems‚Äô : [‚Äò–ø—Ä–µ–¥–º–µ—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ —Å–æ–±—Ä–∞—Ç—å‚Äô] , 
# ‚Äònext_move‚Äô : {‚Äò–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ‚Äô : ‚Äò–ª–æ–∫–∞—Ü–∏—è‚Äô}, 
# ‚Äòexchange‚Äô : {‚Äò—á—Ç–æ –º–µ–Ω—è–µ–º‚Äô : ‚Äò–Ω–∞ —á—Ç–æ –º–µ–Ω—è–µ–º‚Äô}
# }
# }
but_dead = telebot.types.InlineKeyboardMarkup()
but_dead.add(telebot.types.InlineKeyboardButton(text='‚ò†Ô∏è–í—ã –ø–æ–≥–∏–±–ª–∏‚ò†Ô∏è. –ù–∞—á–∞—Ç—å —Å–Ω–∞—á–∞–ª–∞', callback_data='new_game'))
users_info = {}
location = {'1': {'text': '–í—ã –∏–≥—Ä–∞–µ—Ç–µ –∑–∞ –≥–µ—Ä–æ—è, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–ø–∞–ª –≤ –æ–ø–∞—Å–Ω—ã–π –ª–µ—Å, –≤–∞–º –Ω—É–∂–Ω–æ –Ω–∞–π—Ç–∏ –≤—ã—Ö–æ–¥ –≤ –≥–æ—Ä–æ–¥ –∏ –æ—Å—Ç–∞—Ç—å—Å—è –∂–∏–≤—ã–º', 'items': [], 'next_move': {'–ü–æ–π—Ç–∏ –≤–ø–µ—Ä–µ–¥': "2"}, 'exchange':{}},
            '2': {'text': '–í—ã –ø–æ–ø–∞–ª–∏ –≤ –ª–µ—Å –∏ –æ—â—É—Ç–∏–ª–∏ –ø—Ä–∏—è—Ç–Ω—ã–π –∞—Ä–æ–º–∞—Ç —Å–æ—Å–Ω–æ–≤—ã—Ö –¥–µ—Ä–µ–≤—å–µ–≤, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–ø–æ–ª–Ω–∏–ª –ª–µ–≥–∫–∏–µ. –ü–æ—Ö–æ–∂–µ, —á—Ç–æ –≤—ã –æ–∫–∞–∑–∞–ª–∏—Å—å –≤ –≥–ª—É–±–∏–Ω–µ –¥–∏–∫–æ–π –ø—Ä–∏—Ä–æ–¥—ã, –≥–¥–µ –µ—â–µ –Ω–µ –æ—â—É—â–∞–µ—Ç—Å—è —à—É–º –≥–æ—Ä–æ–¥—Å–∫–æ–π —Å—É–µ—Ç—ã.', 'items': ['—Ñ–ª—è–≥–∞'], 'next_move': {"–ü—Ä–æ–π—Ç–∏ –Ω–∞–ª–µ–≤–æ": "3", "–ü—Ä–æ–π—Ç–∏ –ø—Ä—è–º–æ": "4", "–ü—Ä–æ–π—Ç–∏ –Ω–∞–ø—Ä–∞–≤–æ": "5"}, 'exchange':{}},
            '3': {'text': '–ù–∞ –ø–æ–∫—Ä—ã—Ç–æ–π –∑–µ–º–ª–µ –∫–∞–º–µ–Ω–Ω–æ–π –ø–ª–∏—Ç–µ —Å–∏–¥—è—Ç —Ç–µ–º–Ω—ã–µ —Ñ–∏–≥—É—Ä—ã, –∏—Ö –≥–ª–∞–∑–∞ –≥–æ—Ä—è—Ç –≤ —Ç–µ–º–Ω–æ—Ç–µ, –∞ –≤ —Ä—É–∫–∞—Ö —É –Ω–∏—Ö –Ω–æ–∂–∏. –û–Ω–∏ —É–ª—ã–±–∞—é—Ç—Å—è –≤–∞–º –∏ –ø—Ä–æ–∏–∑–Ω–æ—Å—è—Ç "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, –ù–∞—à –Ω–æ–≤—ã–π –¥—Ä—É–≥!". –í–∞–º –Ω–∞—Å—Ç–æ–ª—å–∫–æ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –µ–¥—ã –∏ –≤–æ–¥—ã –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –∏–¥—Ç–∏ –¥–∞–ª—å—à–µ, —á—Ç–æ –≤—ã —Å—Ç–∞–Ω–æ–≤–∏—Ç–µ—Å—å –∏—Ö –∂–µ—Ä—Ç–≤–æ–π –∏ –≤—Å—ë –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –æ—á–µ–Ω—å –ø–ª–æ—Ö–æ', 'items': [], 'next_move': {'–ù–∞—á–∞—Ç—å —Å–Ω–∞—á–∞–ª–∞': "new_game"}, 'exchange':{}},
            '4': {'text': '–í—ã –≤—ã—à–ª–∏ –≤ –ø–æ–ª–µ. –ü–µ—Ä–µ–¥ –≤–∞–º–∏ —Ç–æ—Ä–≥–æ–≤–µ—Ü.', 'items': [], 'next_move': {"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥": "2"}, 'exchange':{"—à–∫–∞—Ç—É–ª–∫–∞": "–∑–æ–ª–æ—Ç–æ: 3"}},
            '5': {'text': '–í—ã –æ–∫–∞–∑–∞–ª–∏—Å—å –æ–∫–æ–ª–æ –ø–æ–¥–∑–µ–º–µ–ª—å—è, –∫–æ—Ç–æ—Ä–æ–µ —Å–º–æ—Ç—Ä–µ–ª–æ—Å—å –¥–æ–≤–æ–ª—å–Ω–æ —Å—Ç—Ä–∞—à–Ω–æ.', 'items': ["–∫–∏—Ä–∫–∞"], 'next_move': {"–í–æ–π—Ç–∏ –≤–Ω—É—Ç—Ä—å": "7", "–û—Å–º–æ—Ç—Ä–µ—Ç—å—Å—è": "6", "–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥": "2"}, 'exchange':{}},
            '6': {'text': '–û—Å–º–∞—Ç—Ä–∏–≤–∞—è—Å—å –≤–æ–∫—Ä—É–≥, –≤—ã –∑–∞–º–µ—á–∞–µ—Ç–µ —á—Ç–æ –Ω–∞ —Å—Ç–µ–Ω–µ —Ä—è–¥–æ–º —Å –≤—Ö–æ–¥–æ–º –∫—Ç–æ-—Ç–æ –Ω–∞–Ω–µ—Å —Å—Ç—Ä–∞–Ω–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –Ω–µ –º–æ–∂–µ—Ç–µ —Ä–∞–∑–≥–∞–¥–∞—Ç—å. –î–∞–ª–µ–µ –í—ã –Ω–µ–º–Ω–æ–≥–æ –µ—â—ë –ø–æ–±—Ä–æ–¥–∏–ª–∏ —Å –Ω–∞–¥–µ–∂–¥–æ–π —á—Ç–æ-—Ç–æ –Ω–∞–π—Ç–∏...', 'items': ["—à–∫–∞—Ç—É–ª–∫–∞"], 'next_move': {"–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø–æ–¥–∑–µ–º–µ–ª—å—é": "5"}, 'exchange':{}},
            '7': {'text': '–°—Ç–µ–Ω—ã –∑–¥–µ—Å—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–∫—Ä—ã—Ç—ã –≥—Ä—É–±—ã–º –∫–∞–º–Ω–µ–º, –∞ –≤ –≤–æ–∑–¥—É—Ö–µ —Ü–∞—Ä–∏—Ç –ø—Ä–æ—Ö–ª–∞–¥–∞ –∏ —Å—ã—Ä–æ—Å—Ç—å. –ü–æ—Ö–æ–∂–µ, —á—Ç–æ –≤—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –Ω–∞ –Ω–∞—á–∞–ª—å–Ω–æ–º —É—Ä–æ–≤–Ω–µ –ø–æ–¥–∑–µ–º–µ–ª—å—è.', 'items': ["–∑–æ–ª–æ—Ç–æ: 2",'—Ç–µ—Ç—Ä–∞–¥—å –ø–æ –∞–ª–≥–µ–±—Ä–µ'], 'next_move': {"–ü–æ–π—Ç–∏ –≤–ø–µ—Ä–µ–¥": "8", "–í—ã–π—Ç–∏ –Ω–∞ —É–ª–∏—Ü—É": "5"}, 'exchange':{}},
            '8': {'text': '–í—ã –ø—Ä–æ—Ö–æ–¥–∏—Ç–µ –¥—é–∞–ª—å—à–µ, —Ç—É—Ç –æ—á–µ–Ω—å —Ç–µ–º–Ω–æ –∏ —Å—ã—Ä–æ. –ù–æ –≤–¥—Ä—É–≥ –≤ –¥–∞–ª–µ–∫–µ –í—ã –∑–∞–º–µ—á–∞–µ—Ç–µ —Å–≤–µ—Ç.', 'items': [], 'next_move': {"–ü–æ–π—Ç–∏ –¥–∞–ª—å—à–µ": "9", "–í–µ—Ä–Ω—É—Ç—å—Å—è": "7"}, 'exchange':{}},
            '9': {'text': '–ö–æ–Ω—Ü–æ–≤–∫–∞ –Ω–µ –∑–∞ –≥–æ—Ä–∞–º–∏, –Ω–æ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ –Ω–µ –æ–±–æ–π–¥—ë—Ç—Å—è –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤. –ù–∞ –≤—Ö–æ–¥–µ —Å—Ç–æ–∏—Ç —Ä–∞–∑–±–æ–π–Ω–∏–∫ —Å —Ç–∞–±–ª–∏—á–∫–æ–π "–≤—ã—Ö–æ–¥ –∑–∞ 5 –∑–æ–ª–æ—Ç—ã—Ö"', 'items': ['–ø–µ—Ä—Å—Ç–µ–Ω—å'], 'next_move': {"–í–µ—Ä–Ω—É—Ç—å—Å—è": "8"}, 'exchange': {"–∑–æ–ª–æ—Ç–æ: 5": "–≤—ã—Ö–æ–¥"}},
            '11': {'text': '–ö–Ω–∏–∂–Ω–∞—è –ø–æ–ª–∫–∞ –≤–µ–ª–∏–∫–∞–Ω–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –º–∞—Å—Å–∏–≤–Ω–æ–µ —Å–æ–æ—Ä—É–∂–µ–Ω–∏–µ, —Å–æ–∑–¥–∞–Ω–Ω–æ–µ –∏–∑ –ø—Ä–æ—á–Ω–æ–≥–æ –¥–µ—Ä–µ–≤–∞ –∏–ª–∏ –º–µ—Ç–∞–ª–ª–∞. –û–Ω–∞ –≤–æ–∑–≤—ã—à–∞–µ—Ç—Å—è –¥–æ —Å–∞–º–æ–≥–æ –ø–æ—Ç–æ–ª–∫–∞, –∏ –Ω–∞ –Ω–µ–π —É–º–µ—â–∞–µ—Ç—Å—è –æ–≥—Ä–æ–º–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–Ω–∏–≥ —Å–∞–º—ã—Ö —Ä–∞–∑–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤ –∏ —Ñ–æ—Ä–º–∞—Ç–æ–≤.', 'items': ['–±–∏–Ω–æ–∫–ª—å'], 'next_move': {'–°–ø—É—Å—Ç–∏—Ç—å—Å—è': '12', '–ü–æ–π—Ç–∏ –Ω–∞–ø—Ä–∞–≤–æ': '13', '–ü–æ–¥–Ω—è—Ç—å—Å—è –Ω–∞–≤–µ—Ä—Ö': '14'}, 'exchange':{}},
            '12': {'text': '–ù–∞—á–∞–≤ —Å–ø—É—Å–∫–∞—Ç—å—Å—è –ø–æ –æ–≥—Ä–æ–º–Ω—ã–º –ø–æ–ª–∫–∞–º —Å –æ–≥—Ä–æ–º–Ω—ã–º–∏ —Ç—Ä–µ—â–µ–Ω–∞–º–∏ –≤ –∫–æ—Ç–æ—Ä—ã–µ —É–¥–æ–±–Ω–æ –ø–æ–º–µ—â–∞—é—Ç—Å—è —Ä—É–∫–∏ –∏ –Ω–æ–≥–∏ –≤—ã –±—ã—Å—Ç—Ä–æ –¥–æ–±—Ä–∞–ª–∏—Å—å –¥–æ –ø–æ–ª–∞', 'items': ['–∫–ª—é—á'], 'next_move': {'–°—Ç—Ä–∞–Ω–Ω–∞—è –¥–≤–µ—Ä—å': '15','–í–µ—Ä–Ω—É—Ç—å—Å—è': '14'}, 'exchange':{}},
            '13': {'text': '–í—ã —à–ª–∏ –Ω–µ –ø–æ–Ω–∏–º–∞—è –∫—É–¥–∞ –∏ –¥—É–º–∞–ª–∏ –∫—É–¥–∞ –≤—ã –ø–æ–ø–∞–ª–∏. –ó–∞–¥—É–º–∞–≤—à–∏—Å—å –≤—ã –Ω–µ —É–≤–∏–¥–µ–ª–∏ –∫–∞–∫ –Ω–∞ –≤–∞—Å —Å–º–æ—Ç—Ä–∏—Ç –æ–≥—Ä–æ–º–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ. –ü—Ä–∏–Ω—è–≤ –≤–∞—Å –∑–∞ —Ç–∞—Ä–∞–∫–∞–Ω–∞, –≤–µ–ª–∏–∫–∞–Ω —Ä–∞–∑–¥–∞–≤–∏–ª –≤–∞—Å...', 'items': [], 'next_move': {'–ù–∞—á–∞—Ç—å —Å–Ω–∞—á–∞–ª–∞': "new_game"}, 'exchange':{}},
            '14': {'text': '–í—ã –Ω–∞—á–∞–ª–∏ –ø–æ–¥–Ω–∏–º–∞—Ç—å—Å—è –Ω–∞ –≤–µ—Ä—Ö –¥—Ä–æ–∂–∞—â–∏–º–∏ —Ä—É–∫–∞–º–∏ –ø—ã—Ç–∞—è—Å—å –ø–æ–¥–Ω—è—Ç—å —Å–≤–æ—ë —É—Å—Ç–∞–≤—à–µ–µ –∏ –≥–æ–ª–æ–¥–Ω–æ–µ —Ç–µ–ª–æ. –ù–µ –≤—ã–¥–µ—Ä–∂–∞–≤ –∏ –ø–æ–ª –ø—É—Ç–∏ –≤—ã –ø–∞–¥–∞–µ—Ç–µ –∏ —Ä–∞–∑–±–∏–≤–∞–µ—Ç–µ—Å—å –±–µ–∑ —Å–∏–ª', 'items': [], 'next_move': {'–ù–∞—á–∞—Ç—å —Å–Ω–∞—á–∞–ª–∞': "new_game"}, 'exchange':{}},
            '15': {'text': '–í—ã –ø–æ–¥–æ—à–ª–∏ –∫ –¥–≤–µ—Ä–∏, –∏ –≤–∏–¥–∏—Ç–µ –æ–±—ã—á–Ω—É—é –∑–∞–º–æ—á–Ω—É—é —Å–∫–≤–∞–∂–∏–Ω—É —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞', 'items': [], 'next_move': {}, 'exchange':{'–∫–ª—é—á': '–æ—Ç–∫—Ä—ã—Ç—å –¥–≤–µ—Ä—å'}}} # '': {'text': '', 'items': [], 'next_move': {}, 'exchange':{}}

comands = {'help': '–í—ã–≤–æ–¥–∏—Ç –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å.',
           'game': "–ù–∞—á–∏–Ω–∞–µ—Ç –ù–û–í–£–Æ –∏–≥—Ä—É",
           'save': '–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–≥—Ä—É',
           'load': '–ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –∏–≥—Ä—É –∑–∞–≥—Ä—É–∑–∏–≤ –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ',
           'items': '–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–æ–±—Ä–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã'}
def generate_story(user,position):
        global users_info
        # –±–µ—Ä–µ–º —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ª–æ–∫–∞—Ü–∏–∏
        txt = users_info[user]['loc'][position]['text']
        #—Å–æ–∑–¥–∞—ë–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
        keyboard = telebot.types.InlineKeyboardMarkup()
        #–°–æ–∑–¥–∞—ë–º –∫–Ω–æ–ø–∫–∏ —Å –æ—Ç–≤–µ—Ç–∞–º–∏ –ø–æ —Å–ª–µ–¥—É—é—â–∏–º —Ö–æ–¥–∞–º
        for i in users_info[user]['loc'][position]['next_move']:
            # –±–µ—Ä–µ–º —Ç–µ–∫—Å—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            key_txt = i+'üö™'
            key_data = users_info[user]['loc'][position]['next_move'][i]
            keyboard.add(telebot.types.InlineKeyboardButton(text=key_txt,callback_data=key_data))
        # —Å–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫–∏ –¥–ª—è –ø—Ä–µ–¥–º–µ—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –≤–∑—è—Ç—å
        for i in users_info[user]['loc'][position]['items']:
            #–±–µ—Ä–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞
            key_txt = f'–í–∑—è—Ç—å –ø—Ä–µ–¥–º–µ—Ç - {i}'
            #–≤ callback_data –¥–æ–±–∞–≤–∏–º –≤ –Ω–∞—á–∞–ª–æ "item", —á—Ç–æ–±—ã –≤ –±—É–¥—É—â–µ–º –±—ã–ª–æ –ø—Ä–æ—â–µ —Ä–∞–∑–¥–µ–ª–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ—É–Ω–∫—Ü–∏–π
            key_data = 'item ' + i
            keyboard.add(telebot.types.InlineKeyboardButton(text=f'{key_txt}üîç',callback_data=key_data))
        for i in users_info[user]['loc'][position]['exchange']:
            # –ø—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —É –Ω–∞—Å –µ—Å—Ç—å –Ω—É–∂–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç –¥–ª—è –æ–±–º–µ–Ω–∞ –∏–ª–∏ –Ω–µ–æ–æ–±—Ö–æ–¥–∏–º–æ–µ –∫–æ–ª-–≤–æ –º–æ–Ω–µ—Ç.
            if i in users_info[user]['items'] or (i.startswith('–∑–æ–ª–æ—Ç–æ: ') and users_info[user]['–∑–æ–ª–æ—Ç–æ'] >= int(i.replace('–∑–æ–ª–æ—Ç–æ: ', ''))):
                # –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç –æ–±–º–µ–Ω–∞
                key_txt = f'üó£–û–±–º–µ–Ω—è—Ç—å –ø—Ä–µ–¥–º–µ—Ç {i} –Ω–∞ {users_info[user]['loc'][position]['exchange'][i]} ü§ù'
                # –≤ callback_data –¥–æ–±–∞–≤–∏–º –≤ –Ω–∞—á–∞–ª–æ 'exchange ', —á—Ç–æ–±—ã –≤ –±—É–¥—É—â–µ–º –±—ã–ª–æ –ø—Ä–æ—â–µ —Ä–∞–∑–¥–µ–ª–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ—É–Ω–∫—Ü–∏–π
                key_data = 'exchange '+i
                keyboard.add(telebot.types.InlineKeyboardButton(text=key_txt,callback_data=key_data))
        return (txt, keyboard)
@bot.message_handler(commands=list(comands.keys()))
def start_game(message):
    global users_info
    if message.text == '/game':
        #–î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Å–ª–æ–≤–∞—Ä—å —Å –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
        users_info[message.from_user.username] = {'cur_pos': '1', '–∑–æ–ª–æ—Ç–æ': 5, 'items': [], 'loc': copy.deepcopy(location)}
        txt, keyboard = generate_story(message.from_user.username,users_info[message.from_user.username]['cur_pos'])
        bot.send_message(message.chat.id,txt,reply_markup=keyboard)
    elif message.text == '/help':
        info = ''
        for i,j in comands.items():
            info += f'/{i} - {j}'+'\n'
        bot.send_message(message.chat.id,info)
    elif message.text == '/save':
        with open(f'{message.from_user.id}_gr15.json','w',encoding='utf-8') as f:
            json.dump(users_info[message.from_user.username],f,indent=2,ensure_ascii=False)
    elif message.text == '/load':
        try:
            with open(f'{message.from_user.id}_gr15.json','r',encoding='utf-8') as f:
                users_info[message.from_user.username] = json.load(f)
            txt, keyboard = generate_story(message.from_user.username,users_info[message.from_user.username]['cur_pos'])
            bot.send_message(message.chat.id,txt,reply_markup=keyboard)
        except Exception as exc:
            bot.send_message(message.chat.id,f'–í–∞—à–∏—Ö —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ(–∏–ª–∏ –æ—à–∏–±–∫–∞ {exc})')
    elif message.text == '/items':
        my_items = (',').join(users_info[message.from_user.username]['items'])
        txt, keyboard = generate_story(message.from_user.username,users_info[message.from_user.username]['cur_pos'])
        bot.send_message(message.chat.id,f'–í–∞—à –ø—Ä–µ–¥–º–µ—Ç—ã: {my_items}')
        bot.send_message(message.chat.id,f'–í–∞—à–µ –∑–æ–ª–æ—Ç–æ: {users_info[message.from_user.username]['–∑–æ–ª–æ—Ç–æ']}',reply_markup=keyboard)
@bot.callback_query_handler(func = lambda call: call.data in location)
def callback_query(call):
    # –º–µ–Ω—è–µ–º —Ç–µ–∫—É—â—É—é –ø–æ–∑–∏—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    users_info[call.from_user.username]['cur_pos'] = call.data
    #–≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤—ã–π —Ç–µ–∫—Å—Ç –∏ –∫–Ω–æ–ø–∫–∏
    txt, keyboard = generate_story(call.from_user.username,users_info[call.from_user.username]['cur_pos'])
    bot.send_message(call.message.chat.id, txt, reply_markup=keyboard)
    
@bot.callback_query_handler(func = lambda call: call.data.startswith('item '))
def callback_query(call):
    # –±–µ—Ä–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞ (–≤ —Å—Ç—Ä–æ–∫–µ –∑–∞–º–µ–Ω—è–µ–º –ø–æ–¥—Å—Ç—Ä–æ–∫—É 'item' –Ω–∞ '')
    item = call.data.replace('item ', '')
    # –µ—Å–ª–∏ –ø—Ä–µ–¥–º–µ—Ç –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –Ω–∞ "–∑–æ–ª–æ—Ç–æ: "
    # —É–¥–∞–ª—è–µ–º —Å –∫–∞—Ä—Ç—ã –ª–æ–∫–∞—Ü–∏–∏ —ç—Ç–æ—Ç –ø—Ä–µ–¥–º–µ—Ç (—á—Ç–æ–±—ã –ø–æ–≤—Ç–æ—Ä–Ω–æ –Ω–µ –≤–∑—è—Ç—å)
    users_info[call.from_user.username]['loc'][users_info[call.from_user.username]['cur_pos']]['items'].remove(item)
    # —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —É–¥–∞—á–Ω–æ–º –¥–µ–π—Å—Ç–≤–∏–∏
    bot.send_message(call.message.chat.id, f'‚ûï–ü–æ–ª—É—á–µ–Ω {item}‚ûï')
    txt, keyboard = generate_story(call.from_user.username,users_info[call.from_user.username]['cur_pos'])
    if item.startswith('–∑–æ–ª–æ—Ç–æ: '):
        # —Ç–æ –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –Ω–∞ –±–∞–ª–Ω—Å —ç—Ç–æ –∫–æ–ª-–≤–æ –º–æ–Ω–µ—Ç
        users_info[call.from_user.username]['–∑–æ–ª–æ—Ç–æ'] += int(item.replace('–∑–æ–ª–æ—Ç–æ: ', ''))
    elif item == '—Ñ–ª—è–≥–∞':
        bot.answer_callback_query(call.id,'–í—ã –ø–æ–≥–∏–±–ª–∏')
        bot.send_message(call.message.chat.id,'–ë–µ—Å–ø–µ—á–Ω–æ —Å–¥–µ–ª–∞–≤ –≥–ª–æ—Ç–æ–∫ –∏–∑ —Ñ–ª—è–≥–∏ –æ—Ç –∂–∞–∂–¥—ã, –≤—ã –ø–æ–Ω—è–ª–∏ —á—Ç–æ —Ñ–ª—è–≥–∞ –±—ã–ª–∞ –Ω–∞–ø–æ–ª–Ω–µ–Ω–∞ "–æ–≥–Ω–µ–Ω–Ω–æ–π –≤–æ–¥–æ–π". –û—Ç –¥—É—Ä–º–∞–Ω–∞ –∏ –≥–æ–ª–æ–¥–∞ –≤—ã —É–ø–∞–ª–∏ –ª–∏—Ü–æ–º –≤ –ª—É–∂—É –∏ –∑–∞—Ö–ª–µ–±–Ω—É–ª–∏—Å—å...',reply_markup=but_dead)
    elif item == '—Ç–µ—Ç—Ä–∞–¥—å –ø–æ –∞–ª–≥–µ–±—Ä–µ':
        bot.answer_callback_query(call.id,'–í—ã –ø–æ–≥–∏–±–ª–∏')
        bot.send_message(call.message.chat.id,'–•–≤–∞—Ç–∞—è –∫–∞–∂–¥—ã–π –Ω–∞–π–¥–µ–Ω–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç –≤—ã –Ω–µ –∑–∞–º–µ—Ç–∏–ª–∏, —á—Ç–æ –≤ —Ç–µ—Ç—Ä–∞–¥–∏ —Å–ø–∏—Ç –∑–º–µ—è. –ó–º–µ—è –∏—Å–ø—É–≥–∞–ª–∞—Å—å –∏ —É–∂–∞–ª–∏–ª–∞ –≤–∞—Å –≤ –≥–ª–∞–∑. –Ø–¥ –≤—ã—Å–æ—Å–∞—Ç—å –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å, –ø–æ —ç—Ç–æ–º—É –≤—ã –ø–æ–≥–∏–±–ª–∏...',reply_markup=but_dead)
    elif item == '–ø–µ—Ä—Å—Ç–µ–Ω—å':
        bot.answer_callback_query(call.id,'–ü–µ—Ä—Å—Ç–µ–Ω—å –±—É–¥—Ç–æ —Å–∫–æ–≤–∞–ª –ø–∞–ª–µ—Ü. –ù–æ —Ç–µ–ø–µ—Ä—å –≤—ã —á—É–≤—Å—Ç–≤—É–µ—Ç–µ, —á—Ç–æ –≤ –ª–µ—Å—É –≤–∞—Å –Ω–∏–∫—Ç–æ –Ω–µ —Ç—Ä–æ–Ω–µ—Ç')
        bot.send_photo(call.message.chat.id,'https://avatars.dzeninfra.ru/get-zen_doc/271828/pub_663a9dea9f669c30c357f34f_663a9e7d8f0f1a1233727a79/scale_1200',reply_markup=keyboard)
        users_info[call.from_user.username]['loc']['3'] = {
            'text': '–ì—Ä—É–ø–ø–∞ —Ä–∞–∑–±–æ–π–Ω–∏–∫–æ–≤ –Ω–∞–ø–∞–¥–∞–µ—Ç –Ω–∞ –í–∞—Å –≤ –ª–µ—Å—É, –ø—Ä–∏–Ω–∏–º–∞—è –∑–∞ –±–æ–≥–∞—Ç–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞. –û–¥–Ω–∞–∫–æ, –∫–æ–≥–¥–∞ –æ–Ω–∏ –≤–∏–¥—è—Ç –ø–µ—Ä—Å—Ç–µ–Ω—å –Ω–∞ –ø–∞–ª—å—Ü–µ, —É–∑–Ω–∞—é—Ç –≤ –Ω—ë–º —Å–∏–º–≤–æ–ª —Å–≤–æ–µ–≥–æ –≤–æ–∂–∞–∫–∞. –û–Ω–∏ –ø–æ–Ω–∏–º–∞—é—Ç, —á—Ç–æ –ø–µ—Ä–µ–¥ –Ω–∏–º–∏ –Ω–µ –æ–±—ã—á–Ω—ã–π —á–µ–ª–æ–≤–µ–∫. –†–∞–∑–±–æ–π–Ω–∏–∫–∏ –æ—Ç—Å—Ç—É–ø–∞—é—Ç, –∏—Å–ø—É–≥–∞–≤—à–∏—Å—å —Å–∏–ª—ã, –∫–æ—Ç–æ—Ä—É—é –º–æ–∂–µ—Ç –ø—Ä–∏–Ω–µ—Å—Ç–∏ –∏–º —ç—Ç–æ—Ç –ø–µ—Ä—Å—Ç–µ–Ω—å.', 
            'items': [], 
            'next_move': {'–¢—Ä–æ–ø–∞ –∏–∑ –ª–µ—Å–∞': 'game_over'}, 
            'exchange':{}
        }
    else:
        # –∏–Ω–∞—á–µ –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–ª—è–µ–º –≤ —Å–ø–∏—Å–æ–∫ –ø—Ä–µ–¥–º–µ—Ç–æ–≤
        users_info[call.from_user.username]['items'].append(item)
        bot.send_message(call.message.chat.id,txt,reply_markup=keyboard)
@bot.callback_query_handler(func = lambda call: call.data.startswith('exchange '))
def callback_query(call):
    # –±–µ—Ä–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞ (–≤ —Å—Ç—Ä–æ–∫–µ –∑–∞–º–µ–Ω—è–µ–º –ø–æ–¥—Å—Ç—Ä–æ–∫—É 'exchange ' –Ω–∞ '')
    item1 = call.data.replace('exchange ', '')
    # –±–µ—Ä–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞ (–∏–∑ —Å–ª–æ–≤–∞—Ä—è), –∫–æ—Ç–æ—Ä—ã–π –ø–æ–ª—É—á–∏–º
    item2 = users_info[call.from_user.username]['loc'][users_info[call.from_user.username]['cur_pos']]['exchange'][item1]
    # –ï—Å–ª–∏ item1 –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å '–∑–æ–ª–æ—Ç–æ: '
    if item1.startswith('–∑–æ–ª–æ—Ç–æ: '):
        #—É–º–µ–Ω—å—à–∞–µ–º –∫–æ–ª-–≤–æ –º–æ–Ω–µ—Ç. –ù–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä—è—Ç—å –Ω–µ –Ω—É–∂–Ω–æ, –º—ã —ç—Ç–æ —Å–¥–µ–ª–∞–ª–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–Ω–æ–ø–æ–∫ –æ–±–º–µ–Ω–∞
        users_info[call.from_user.username]['–∑–æ–ª–æ—Ç–æ'] -= int(item1.replace('–∑–æ–ª–æ—Ç–æ: ', ''))
    else:
        # –∏–Ω–∞—á–µ —É–¥–∞–ª—è–µ–º –ø—Ä–µ–¥–º–µ—Ç
        users_info[call.from_user.username]['items'].remove(item1)
    #–µ—Å–ª–∏ –º—ã –º–µ–Ω—è–µ–º –Ω–∞ –∑–æ–ª–æ—Ç–æ
    if item2.startswith('–∑–æ–ª–æ—Ç–æ: '):
        #—É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –±–∞–ª–∞–Ω—Å
        users_info[call.from_user.username]['–∑–æ–ª–æ—Ç–æ'] += int(item2.replace('–∑–æ–ª–æ—Ç–æ: ', ''))
    else:
        # –∏–Ω–∞—á–µ –¥–æ–±–∞–≤–ª—è–µ–º –Ω–∞–º –ø—Ä–µ–¥–º–µ—Ç
        users_info[call.from_user.username]['items'].append(item2)
        #—É–¥–∞–ª—è–µ–º —Å –ª–æ–∫–∞—Ü–∏–∏ —ç—Ç–æ—Ç –æ–±–º–µ–Ω
    users_info[call.from_user.username]['loc'][users_info[call.from_user.username]['cur_pos']]['exchange'].pop(item1)
    if item2 == '–≤—ã—Ö–æ–¥':
        users_info[call.from_user.username]['cur_pos'] = '11'
        text = '''–£—Å–ª—ã—à–∞–≤ –≥—Ä–æ–º–∫–∏–π —Ö–ª–æ–ø–æ–∫ –∑–∞–∫—Ä—ã–≤–∞—é—â–µ–π—Å—è –¥–≤–µ—Ä–∏, –≤—ã –æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç–µ—Å—å –ø–æ —Å—Ç–æ—Ä–æ–Ω–∞–º. –û–≥—Ä–æ–º–Ω–∞—è –∫–æ–º–Ω–∞—Ç–∞, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–∞—è –¥–ª—è –≤–µ–ª–∏–∫–∞–Ω–æ–≤, –ø–æ—Ä–∞–∂–∞–ª–∞ —Å–≤–æ–∏–º–∏ —Ä–∞–∑–º–µ—Ä–∞–º–∏. 
–í –Ω–µ–π —Ü–∞—Ä–∏–ª–∞ –∞—Ç–º–æ—Å—Ñ–µ—Ä–∞ –≤–µ–ª–∏—á–∏—è –∏ –º–æ—â–∏. –û–≥—Ä–æ–º–Ω—ã–µ –æ–∫–Ω–∞ –ø—Ä–æ–ø—É—Å–∫–∞–ª–∏ –º–Ω–æ–≥–æ —Å–≤–µ—Ç–∞, –±–ª–∞–≥–æ–¥–∞—Ä—è —á–µ–º—É –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –∫–∞–∑–∞–ª–æ—Å—å –µ—â—ë –±–æ–ª–µ–µ –ø—Ä–æ—Å—Ç–æ—Ä–Ω—ã–º. 
–í —Ü–µ–Ω—Ç—Ä–µ –∫–æ–º–Ω–∞—Ç—ã —Å—Ç–æ—è–ª —Å—Ç–æ–ª, —Å–ø–æ—Å–æ–±–Ω—ã–π –≤–º–µ—Å—Ç–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–µ—Å—è—Ç–∫–æ–≤ –ª—é–¥–µ–π. –°—Ç–µ–Ω—ã –±—ã–ª–∏ —É–∫—Ä–∞—à–µ–Ω—ã –∫–∞—Ä—Ç–∏–Ω–∞–º–∏ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º —Å—Ü–µ–Ω –∏–∑ –∂–∏–∑–Ω–∏ –≤–µ–ª–∏–∫–∞–Ω–æ–≤.
–í—ã –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –æ—Å–º–æ—Ç—Ä–µ–ª–∏ –∫–æ–º–Ω–∞—Ç—É –≤ –ø–æ–∏—Å–∫–∞—Ö –≤—ã—Ö–æ–¥–∞. 
–í—ã –∑–∞–º–µ—Ç–∏–ª–∏ –º–∞–ª–µ–Ω—å–∫—É—é –¥–≤–µ—Ä—å –≤ —É–≥–ª—É –ø–æ–º–µ—â–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä–∞—è –º–æ–≥–ª–∞ –±—ã—Ç—å –≤—ã—Ö–æ–¥–æ–º. 
–¢–µ–ø–µ—Ä—å –≤–∞—à–∞ —Ü–µ–ª—å –≤—ã–±—Ä–∞—Ç—å—Å—è –æ—Ç—Å—é–¥–∞ –∂–∏–≤—ã–º.  –í–µ–¥—å –µ—Å–ª–∏ –µ—Å—Ç—å –¥–≤–µ—Ä—å, –∫–æ—Ç–æ—Ä–∞—è –¥–æ–≤–æ–ª—å–Ω–æ –º–∞–ª–∞ –¥–ª—è –≤–µ–ª–∏–∫–∞, –∑–Ω–∞—á–∏—Ç –¥–ª—è –Ω–µ—ë –µ—Å—Ç—å –∏ –∫–ª—é—á.'''
        bot.send_message(call.message.chat.id,text)
        txt, keyboard = generate_story(call.from_user.username,users_info[call.from_user.username]['cur_pos'])
        bot.send_message(call.message.chat.id,txt,reply_markup=keyboard)
    elif item2 == '–æ—Ç–∫—Ä—ã—Ç—å –¥–≤–µ—Ä—å':
        users_info[call.from_user.username]['loc']['15']['next_moove'] = {'–í–æ–π—Ç–∏ –≤ –¥–≤–µ—Ä—å': '5'}
        txt, keyboard = generate_story(call.from_user.username,users_info[call.from_user.username]['cur_pos'])
        bot.send_message(call.message.chat.id,'–£—Å–ª—ã—à–∞–≤ –ø–æ–≤–æ—Ä–æ—Ç –∑–æ–º–∫–∞, –ø–æ–Ω—è–≤ —á—Ç–æ –¥–≤–µ—Ä—å —Ç–µ–ø–µ—Ä—å –Ω–µ –∑–∞–ø–µ—Ä—Ç–∞ –≤—ã –º–æ–∂–µ—Ç–µ —Å–¥–µ–ª–∞—Ç—å —à–∞–≥ –≤–Ω—É—Ç—Ä—å',reply_markup=keyboard)
    else:
        # —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É–¥–∞—á–Ω–æ–º –¥–µ–π—Å—Ç–≤–∏–∏
        bot.send_message(call.message.chat.id,f'–û–±–º–µ–Ω –∑–∞–≤–µ—Ä—à—ë–Ω. –ü–æ–ª—É—á–µ–Ω–æ {item2}')
        txt, keyboard = generate_story(call.from_user.username,users_info[call.from_user.username]['cur_pos'])
        bot.send_message(call.message.chat.id,txt,reply_markup=keyboard)
@bot.callback_query_handler(func = lambda call: call.data.startswith('new_game'))
def new_game(call):
    bot.answer_callback_query(call.id,'–í—Å–µ –≤–∞—à–∏ –ø—Ä–µ–¥–º–µ—Ç—ã —É–¥–∞–ª–µ–Ω—ã')
    users_info[call.from_user.username] = {'cur_pos': '1', '–∑–æ–ª–æ—Ç–æ': 0, 'items': [], 'loc': copy.deepcopy(location)}
    txt, keyboard = generate_story(call.from_user.username,users_info[call.from_user.username]['cur_pos'])
    bot.send_message(call.message.chat.id,txt,reply_markup=keyboard)
@bot.callback_query_handler(func = lambda call: call.data.startswith('game_over'))
def game_over(call):
    bot.answer_callback_query(call.id,'–ö–æ–Ω–µ—Ü –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è')
    bot.send_message(call.message.chat.id,'–ü–æ—Å–ª–µ –¥–æ–ª–≥–∏—Ö —á–∞—Å–æ–≤ –±–ª—É–∂–¥–∞–Ω–∏—è –ø–æ –ª–µ—Å—É –í—ã –Ω–∞–∫–æ–Ω–µ—Ü-—Ç–æ —É–≤–∏–¥–µ–ª–∏ –ø—Ä–æ—Å–≤–µ—Ç –º–µ–∂–¥—É –¥–µ—Ä–µ–≤—å—è–º–∏. –í—ã –æ–±—Ä–∞–¥–æ–≤–∞–ª—Å–∏—Å—å –∏ –ø–æ—à–ª–∏ –≤ —Ç—É —Å—Ç–æ—Ä–æ–Ω—É, –Ω–∞–¥–µ—è—Å—å –≤—ã–π—Ç–∏ –Ω–∞ –æ—Ç–∫—Ä—ã—Ç—É—é –º–µ—Å—Ç–Ω–æ—Å—Ç—å. –ü—Ä–æ–π–¥—è –µ—â—ë –Ω–µ–º–Ω–æ–≥–æ, –≤—ã –∑–∞–º–µ—Ç–∏–ª–∏ —Ç—Ä–æ–ø–∏–Ω–∫—É, –∫–æ—Ç–æ—Ä–∞—è –≤–µ–ª–∞ –∏–∑ –ª–µ—Å–∞. –í—ã —Ä–µ—à–∏–ª–∏ –ø–æ–π—Ç–∏ –ø–æ –Ω–µ–π –∏ –≤—Å–∫–æ—Ä–µ –≤—ã—à–ª–∏ –Ω–∞ –¥–æ—Ä–æ–≥—É.')
if __name__ == '__main__':
    bot.infinity_polling()
