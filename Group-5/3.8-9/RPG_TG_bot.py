import telebot,random,json,copy,time
with open('token_5gr.txt') as f:
    TOKEN = f.read()
bot = telebot.TeleBot(TOKEN)

users_info = {}
# '': {'text': '', 'items': [], 'next_move': {}, 'exchange': {}}
answers = ['–¥—ã—Ö–∞–Ω–∏–µ','—ç—Ö–æ','–≤—á–µ—Ä–∞, —Å–µ–≥–æ–¥–Ω—è, –∑–∞–≤—Ç—Ä–∞', '–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ','—Ñ–µ–≤—Ä–∞–ª—å','–≤ –∫–∞–∂–¥–æ–º']
check_ans = 0
zagadki = {
    '–õ–µ–≥—á–µ –ø–µ—Ä–∞, –Ω–æ –¥–æ–ª—å—à–µ –¥–≤—É—Ö –º–∏–Ω—É—Ç –µ–≥–æ –Ω–µ —É–¥–µ—Ä–∂–∏—à—å. –ß—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ?': '–¥—ã—Ö–∞–Ω–∏–µ',
    "–¢—ã –º–µ–Ω—è —Å–ª—ã—à–∏—à—å, –Ω–æ –Ω–µ –≤–∏–¥–∏—à—å. –Ø –Ω–µ –≥–æ–≤–æ—Ä—é, –ø–æ–∫–∞ —Ç—ã –Ω–µ —Å–∫–∞–∂–µ—à—å. –ß—Ç–æ —è?": "—ç—Ö–æ",
    "–ù–∞–∑–æ–≤–∏ —Ç—Ä–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –¥–Ω—è, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —è–≤–ª—è—é—Ç—Å—è –¥–Ω—è–º–∏ –Ω–µ–¥–µ–ª–∏.": "–≤—á–µ—Ä–∞, —Å–µ–≥–æ–¥–Ω—è, –∑–∞–≤—Ç—Ä–∞",
    "–ö–∞–∫–æ–µ —Å–ª–æ–≤–æ –≤—Å–µ–≥–¥–∞ –ø–∏—à–µ—Ç—Å—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ?": "–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ",
    "–í –∫–∞–∫–æ–º –º–µ—Å—è—Ü–µ –ª—é–¥–∏ –º–µ–Ω—å—à–µ –≤—Å–µ–≥–æ —Å–ø—è—Ç?": "—Ñ–µ–≤—Ä–∞–ª—å",
    "–í –∫–∞–∫–æ–º –º–µ—Å—è—Ü–µ 28 –¥–Ω–µ–π?": "–≤ –∫–∞–∂–¥–æ–º"
}
locations = {
    '1': {'text': '–í—ã –∏–≥—Ä–∞–µ—Ç–µ –∑–∞ –≥–µ—Ä–æ—è, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–ø–∞–ª –≤ –æ–ø–∞—Å–Ω—ã–π –ª–µ—Å, –≤–∞–º –Ω—É–∂–Ω–æ –Ω–∞–π—Ç–∏ –≤—ã—Ö–æ–¥ –≤ –≥–æ—Ä–æ–¥ –∏ –æ—Å—Ç–∞—Ç—å—Å—è –∂–∏–≤—ã–º', 'items': [], 'next_move': {'–ü–æ–π—Ç–∏ –≤–ø–µ—Ä–µ–¥': "2"}, 'exchange': {}},
    '2': {'text': '–í—ã –ø–æ–ø–∞–ª–∏ –≤ –ª–µ—Å –∏ –æ—â—É—Ç–∏–ª–∏ –ø—Ä–∏—è—Ç–Ω—ã–π –∞—Ä–æ–º–∞—Ç —Å–æ—Å–Ω–æ–≤—ã—Ö –¥–µ—Ä–µ–≤—å–µ–≤, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–ø–æ–ª–Ω–∏–ª –ª–µ–≥–∫–∏–µ. –ü–æ—Ö–æ–∂–µ, —á—Ç–æ –≤—ã –æ–∫–∞–∑–∞–ª–∏—Å—å –≤ –≥–ª—É–±–∏–Ω–µ –¥–∏–∫–æ–π –ø—Ä–∏—Ä–æ–¥—ã, –≥–¥–µ –µ—â—ë –Ω–µ –æ—â—É—â–∞–µ—Ç—Å—è —à—É–º –≥–æ—Ä–æ–¥—Å–∫–æ–π —Å—É–µ—Ç—ã.', 'items': ['—Ñ–ª—è–≥–∞'], 'next_move': {"–ü—Ä–æ–π—Ç–∏ –Ω–∞–ª–µ–≤–æ": "3", "–ü—Ä–æ–π—Ç–∏ –ø—Ä—è–º–æ": "4", "–ü—Ä–æ–π—Ç–∏ –Ω–∞–ø—Ä–∞–≤–æ": "5"}, 'exchange': {}},
    '3': {'text': '–Ω–∞ –ø–æ–∫—Ä—ã—Ç–æ–π –∑–µ–º–ª–µ –∫–∞–º–µ–Ω–Ω–æ–π –ø–ª–∏—Ç–µ —Å–∏–¥—è—Ç —Ç–µ–º–Ω—ã–µ —Ñ–∏–≥—É—Ä—ã, –∏—Ö –≥–ª–∞–∑–∞ –≥–æ—Ä—è—Ç –≤ —Ç–µ–º–Ω–æ—Ç–µ, –∞ –≤ —Ä—É–∫–∞—Ö —É –Ω–∏—Ö –Ω–æ–∂–∏. –û–Ω–∏ —É–ª—ã–±–∞—é—Ç—Å—è –≤–∞–º –∏ –ø—Ä–æ–∏–∑–Ω–æ—Å—è—Ç "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, –Ω–∞—à –Ω–æ–≤—ã–π –¥—Ä—É–≥!". –í–∞–º –Ω–∞—Å—Ç–æ–ª—å–∫–æ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –µ–¥—ã –∏ –≤–æ–¥—ã –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –∏–¥—Ç–∏ –¥–∞–ª—å—à–µ, —á—Ç–æ –≤—ã —Å—Ç–∞–Ω–æ–≤–∏—Ç–µ—Å—å –∏—Ö –∂–µ—Ä—Ç–≤–æ–π –∏ –≤—Å–µ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –æ—á–µ–Ω—å –ø–ª–æ—Ö–æ.', 'items': [], 'next_move': {"–í—ã –ø–æ–≥–∏–±–ª–∏. –ù–∞—á–∞—Ç—å —Å–Ω–∞—á–∞–ª–∞?": "new_game"}, 'exchange': {}},
    '4': {'text': '–í—ã –≤—ã—à–ª–∏ –≤ –ø–æ–ª–µ. –ü–µ—Ä–µ–¥ –≤–∞–º–∏ —Ç–æ—Ä–≥–æ–≤–µ—Ü', 'items': ['—Å–∞–ø–æ–≥'], 'next_move': {"–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –ø–µ—Ä–µ–∫—Ä—ë—Å—Ç–æ–∫": "2"}, 'exchange': {'—à–∫–∞—Ç—É–ª–∫–∞': "–∑–æ–ª–æ—Ç–æ: 3"}},
    '5': {'text': '–í—ã –æ–∫–∞–∑–∞–ª–∏—Å—å –æ–∫–æ–ª–æ –ø–æ–¥–∑–µ–º–µ–ª—å—è, –∫–æ—Ç–æ—Ä–æ–µ —Å–º–æ—Ç—Ä–µ–ª–æ—Å—å –¥–æ–≤–æ–ª—å–Ω–æ —Å—Ç—Ä–∞—à–Ω–æ', 'items': ['–∫–∏—Ä–∫–∞'], 'next_move': {"–í–µ—Ä–Ω—É—Ç—å—Å—è": "2", "–í–æ–π—Ç–∏ –≤ –ø–æ–¥–∑–µ–º–µ–ª—å–µ": "7", "–û—Å–º–æ—Ç—Ä–µ—Ç—å—Å—è": "6"}, 'exchange': {}},
    '6': {'text': '–û—Å–º–∞—Ç—Ä–∏–≤–∞—è—Å—å –≤–æ–∫—Ä—É–≥, –≤—ã –∑–∞–º–µ—á–∞–µ—Ç–µ, —á—Ç–æ –Ω–∞ —Å—Ç–µ–Ω–µ —Ä—è–¥–æ–º —Å –≤—Ö–æ–¥–æ–º –∫—Ç–æ-—Ç–æ –Ω–∞–Ω–µ—Å —Å—Ç—Ä–∞–Ω–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –Ω–µ –º–æ–∂–µ—Ç–µ —Ä–∞–∑–≥–∞–¥–∞—Ç—å. –î–∞–ª–µ–µ —Ç—ã –Ω–µ–º–Ω–æ–≥–æ –µ—â—ë –ø–æ–±—Ä–æ–¥–∏–ª —Å –Ω–∞–¥–µ–∂–¥–æ–π —á—Ç–æ-—Ç–æ –Ω–∞–π—Ç–∏...', 'items': ["—à–∫–∞—Ç—É–ª–∫–∞"], 'next_move': {"–í–µ—Ä–Ω—É—Ç—å—Å—è": "5"}, 'exchange': {}},
    '7': {'text': '–°—Ç–µ–Ω—ã –∑–¥–µ—Å—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–∫—Ä—ã—Ç—ã –≥—Ä—É–±—ã–º –∫–∞–º–Ω–µ–º, –∞ –≤ –≤–æ–∑–¥—É—Ö–µ —Ü–∞—Ä–∏—Ç –ø—Ä–æ—Ö–ª–∞–¥–∞ –∏ —Å—ã—Ä–æ—Å—Ç—å. –ü–æ—Ö–æ–∂–µ, —á—Ç–æ –≤—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –Ω–∞ –Ω–∞—á–∞–ª—å–Ω–æ–º —É—Ä–æ–≤–Ω–µ –ø–æ–¥–∑–µ–º–µ–ª—å—è.', 'items': ["–∑–æ–ª–æ—Ç–æ: 2"], 'next_move': {"–í–µ—Ä–Ω—É—Ç—å—Å—è": "5", "–ü–æ–π—Ç–∏ –¥–∞–ª—å—à–µ": "8"}, 'exchange': {}},
    '8': {'text': '–¢—ã –ø—Ä–æ—Ö–æ–¥–∏—à—å –¥–∞–ª–ª—å—à–µ, —Ç—É—Ç –æ—á–µ–Ω—å —Ç–µ–º–Ω–æ –∏ —Å—ã—Ä–æ. –ù–æ –≤–¥—Ä—É–≥ –≤ –¥–∞–ª–µ–∫–µ —Ç—ã –∑–∞–º–µ—á–∞–µ—à—å —Å–≤–µ—Ç.', 'items': ['—Ç–µ—Ç—Ä–∞–¥—å –ø–æ –∞–ª–≥–µ–±—Ä–µ','–ø–µ—Ä—Å—Ç–µ–Ω—å'], 'next_move': {"–í–µ—Ä–Ω—É—Ç—å—Å—è": "7", "–ü—Ä–æ–π—Ç–∏ –¥–∞–ª—å—à–µ": "9"}, 'exchange': {}},
    '9': {'text': '–ö–æ–Ω—Ü–æ–≤–∫–∞ –Ω–µ –∑–∞ –≥–æ—Ä–∞–º–∏, –Ω–æ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ –Ω–µ –æ–±–æ–π–¥–µ—Ç—Å—è –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤. –£ –≤—ã—Ö–æ–¥–∞ —Å—Ç–æ–∏—Ç —Ä–∞–∑–±–æ–π–Ω–∏–∫ —Å —Ç–∞–±–ª–∏—á–∫–æ–π "–≤—ã—Ö–æ–¥ –∑–∞ 5 –∑–æ–ª–æ—Ç—ã—Ö".', 'items': [], 'next_move': {}, 'exchange': {"–∑–æ–ª–æ—Ç–æ: 5": "–≤—Ö–æ–¥"}},
    '10': {'text': '–•–∏–∂–∏–Ω–∞ —Ä–∞–∑–±–æ–π–Ω–∏–∫–æ–≤ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–ª–∞ —Å–æ–±–æ–π –ø—Ä–æ—Å—Ç–æ–µ —Å—Ç—Ä–æ–µ–Ω–∏–µ –∏–∑ –±–æ–ª—å—à–∏—Ö –∫–∞–º–Ω–µ–π —Å —Ö–ª–∏–ø–∫–æ–π —Å–æ–ª–æ–º–µ–Ω–Ω–æ–π –∫—Ä—ã—à–µ–π. –ù–∞ –∫—Ä—ã—à–µ –±—ã–ª –∑–Ω–∞–∫ —Å —á—ë—Ä–Ω—ã–º–∏ –ø–µ—Ä–µ–∫—Ä–µ—â—ë–Ω–Ω—ã–º–∏ –∫–æ—Å—Ç—è–º–∏ –≤ –∫—Ä–∞—Å–Ω–æ–º –∫—Ä—É–≥—É. –ù–∞ —Å—Ç–æ–ª–µ –≤ —Ö–∏–∂–∏–Ω–µ —Ä–∞–∑–±–æ–π–Ω–∏–∫–æ–≤ —Å—Ç–æ—è–ª–∞ –µ–¥–∞. –¢–∞–º –±—ã–ª–∏ —Ñ—Ä—É–∫—Ç—ã, –æ–≤–æ—â–∏, –º—è—Å–æ –∏ —Ö–ª–µ–±. –¢–∞–∫–∂–µ –Ω–∞ —Å—Ç–æ–ª–µ –º–æ–∂–Ω–æ –±—ã–ª–æ —É–≤–∏–¥–µ—Ç—å –∫—É–≤—à–∏–Ω—ã —Å –≤–æ–¥–æ–π –∏ –∫—Ä—É–∂–∫–∏.', 'items': ['–Ω–æ–∂','—Ñ–ª–∞–≥ –≤–æ—Ä–æ–≤','—Ö–ª–µ–±'], 'next_move': {'–í—ã–π—Ç–∏ –∏–∑ —Ö–∏–∂–∏–Ω–∞ –≤ –ª–µ—Å': '11'}, 'exchange': {}},
    '11': {'text': '–í—ã —Å–Ω–æ–≤–∞ –æ–∫–∞–∑–∞–ª–∏—Å—å –≤ –ª–µ—Å—É, –Ω–æ —É–∂–µ –ø–æ–ª–Ω—ã —Å–∏–ª. –í—ã –≤–∏–¥–∏—Ç–µ –∑–Ω–∞–∫ "–ù–∞–ª–µ–≤–æ: –¥–∏–∫–∞—è —Ç—Ä–æ–ø–∞", "–ü—Ä—è–º–æ: –ò–∑–±—É—à–∫–∞", "–ù–∞–ø—Ä–∞–≤–æ: –†–∞–∑–±–æ–π–Ω–∏—á–∏–π –ø–∏—Ä"', 'items': [], 'next_move': {'–ü–æ–π—Ç–∏ –Ω–∞–ª–µ–≤–æ': "12", "–ü–æ–π—Ç–∏ –ø—Ä—è–º–æ": "13", "–ü–æ–π—Ç–∏ –Ω–∞–ø—Ä–∞–≤–æ": "14"}, 'exchange': {}},
    '12': {'text': '–î–∏–∫–∞—è —Ç—Ä–æ–ø–∞ –≤ –ª–µ—Å—É –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —É–∑–∫—É—é, –∏–∑–≤–∏–ª–∏—Å—Ç—É—é –¥–æ—Ä–æ–∂–∫—É, –ø–æ–∫—Ä—ã—Ç—É—é –º—Ö–æ–º –∏ –∑–∞—Ä–æ—Å—à—É—é —Ç—Ä–∞–≤–æ–π. –û–Ω–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ –≥—É—Å—Ç—ã–µ –∑–∞—Ä–æ—Å–ª–∏ –¥–µ—Ä–µ–≤—å–µ–≤, —Å–æ–∑–¥–∞–≤–∞—è –æ—â—É—â–µ–Ω–∏–µ —Ç–∞–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∏ —É–µ–¥–∏–Ω–µ–Ω–∏—è. ', 'items': ['—è–≥–æ–¥—ã'], 'next_move': {'–í—ã—Ö–æ–¥ –Ω–∞ –ø–æ–ª–µ': '4','–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —É–∫–∞–∑–∞—Ç–µ–ª—é': '11'}, 'exchange': {}},
    '13': {'text': '–í –≥–ª—É–±–∏–Ω–µ –≥—É—Å—Ç–æ–≥–æ –ª–µ—Å–∞, –≥–¥–µ –¥–µ—Ä–µ–≤—å—è —Å—Ç–æ—è—Ç —Ç–∞–∫ –ø–ª–æ—Ç–Ω–æ, —á—Ç–æ –∏—Ö –∫—Ä–æ–Ω—ã –æ–±—Ä–∞–∑—É—é—Ç –∑–µ–ª—ë–Ω—ã–π –∫—É–ø–æ–ª –Ω–∞–¥ –≥–æ–ª–æ–≤–æ–π, —Å—Ç–æ–∏—Ç –∏–∑–±—É—à–∫–∞. –ï—ë —Å—Ç–µ–Ω—ã —Å–¥–µ–ª–∞–Ω—ã –∏–∑ —Ç–æ–ª—Å—Ç—ã—Ö –±—Ä—ë–≤–µ–Ω, –∞ –∫—Ä—ã—à–∞ –ø–æ–∫—Ä—ã—Ç–∞ –º—Ö–æ–º –∏ –ª–∏—à–∞–π–Ω–∏–∫–æ–º. –ú–∞–ª–µ–Ω—å–∫–∏–µ –æ–∫–Ω–∞ —Å –¥–µ—Ä–µ–≤—è–Ω–Ω—ã–º–∏ —Å—Ç–∞–≤–Ω—è–º–∏ –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç –Ω–µ–º–Ω–æ–≥–æ —Å–≤–µ—Ç–∞ –≤–Ω—É—Ç—Ä—å.', 'items': ['–ª–∏—Å—Ç–æ–∫ —Å –ø–æ–¥—Å–∫–∞–∑–∫–∞–º–∏'], 'next_move': {'–í–æ–π—Ç–∏ –≤ –∏–∑–±—É—à–∫—É': '15'}, 'exchange': {}},
    '15': {'text': '–ò–∑–±–∞ –≤–Ω—É—Ç—Ä–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —Ç—ë–º–Ω–æ–µ –∏ –º—Ä–∞—á–Ω–æ–µ –ø–æ–º–µ—â–µ–Ω–∏–µ. –í —Ü–µ–Ω—Ç—Ä–µ –∫–æ–º–Ω–∞—Ç—ã —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∞ –±–æ–ª—å—à–∞—è –ø–µ—á—å, —Å–ª—É–∂–∞—â–∞—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º —Ç–µ–ø–ª–∞ –∏ —Å–≤–µ—Ç–∞. –£ —Å—Ç–µ–Ω –Ω–∞—Ö–æ–¥—è—Ç—Å—è –¥–µ—Ä–µ–≤—è–Ω–Ω—ã–µ –ª–∞–≤–∫–∏ –∏ –ø–æ–ª–∫–∏, –Ω–∞ –∫–æ—Ç–æ—Ä—ã—Ö —Ö—Ä–∞–Ω—è—Ç—Å—è —Ä–∞–∑–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã, —Ç–∞–∫–∏–µ –∫–∞–∫ –º–µ—Ç–ª–∞, —Å—Ç—É–ø–∞, —Å—É—à—ë–Ω—ã–µ —Ç—Ä–∞–≤—ã –∏ –∫–æ—Ä–µ–Ω—å—è. –í —É–≥–ª—É —Å—Ç–æ–∏—Ç —Å—Ç–∞—Ä—ã–π —Å—É–Ω–¥—É–∫, –ø–æ–ª–Ω—ã–π —Ç–∞–π–Ω –∏ –∑–∞–≥–∞–¥–æ–∫. –í–Ω—É—Ç—Ä–∏ –≤–∞—Å –≤—Å—Ç—Ä–µ—Ç–∏–ª–∞ –ë–∞–±–∞-–Ø–≥–∞. –í—ã –¥–æ–ª–∂–Ω—ã –æ—Ç–≥–∞–¥–∞—Ç—å –µ—ë –∑–∞–≥–∞–¥–∫–∏, –∏–Ω–∞—á–µ –∂–∏–≤—ã–º –Ω–µ –≤—ã–±—Ä–∞—Ç—å—Å—è. –ù–æ –µ—Å–ª–∏ –æ—Ç–≥–∞–¥–∞–µ—Ç–µ, –ø—É—Ç—å –¥–æ–º–æ–π –Ω–∞–π—Ç–∏ –ø–æ–º–æ–∂–µ—Ç.', 'items': [], 'next_move': {'–°—ã–≥—Ä–∞—Ç—å —Å –±–∞–±–æ–π —è–≥–æ–π': '–∑–∞–≥–∞–¥–∫–∏ '}, 'exchange': {}}
}

comands = {'help': '–í—ã–≤–æ–¥–∏—Ç –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã',
           'game': '–ù–∞—á–∏–Ω–∞–µ—Ç –ù–û–í–£–Æ –∏–≥—Ä—É',
           'save': '–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–≥—Ä—É',
           'load': '–ü—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –∏–≥—Ä—É —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è',
           'items': '–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–æ–±—Ä–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã –∏ –∑–æ–ª–æ—Ç–æ'}
key_death = telebot.types.InlineKeyboardMarkup()
key_death.add(telebot.types.InlineKeyboardButton(text='–ù–∞—á–∞—Ç—å —Å–Ω–∞—á–∞–ª–∞', callback_data='new_game'))
key_zagadka = telebot.types.InlineKeyboardMarkup()
for i in answers:
    key_zagadka.add(telebot.types.InlineKeyboardButton(text=i,callback_data='–∑–∞–≥–∞–¥–∫–∏ '+i))
def generate_story(user,position):
    #–±–µ—Ä–µ–º —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ª–æ–∫–∞—Ü–∏–∏
    txt = users_info[user]['loc'][position]['text']
    #—Å–æ–∑–¥–∞—ë–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
    keyboard = telebot.types.InlineKeyboardMarkup()
    #—Å–æ–∑–¥–∞—ë–º –∫–Ω–æ–ø–∫–∏ —Å –æ—Ç–≤–µ—Ç–∞–º–∏ –ø–æ —Å–ª–µ–¥—É—é—â–∏–º —Ö–æ–¥–∞–º
    for i in users_info[user]['loc'][position]['next_move']:
        # –±–µ—Ä–µ–º —Ç–µ–∫—Å—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        key_txt = i+'üö™'
        # –±–µ—Ä–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –ª–æ–∫–∞—Ü–∏–∏
        key_data = users_info[user]['loc'][position]['next_move'][i]
        keyboard.add(telebot.types.InlineKeyboardButton(text=key_txt,callback_data=key_data))
    # —Å–æ–∑–¥–∞—ë–º –∫–Ω–æ–ø–∫–∏ –¥–ª—è –ø—Ä–µ–¥–º–µ—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –≤–∑—è—Ç—å
    for i in users_info[user]['loc'][position]['items']:
        # –±–µ—Ä–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞
        key_txt = f'–í–∑—è—Ç—å –ø—Ä–µ–¥–º–µ—Ç {i} üîç'
        key_data = 'item '  + i
        keyboard.add(telebot.types.InlineKeyboardButton(text=key_txt,callback_data=key_data))
    # —Å–æ–∑–¥–∞—ë–º –∫–Ω–æ–ø–∫–∏ –¥–ª—è –æ–±–º–µ–Ω–∞ –ø—Ä–µ–¥–º–µ—Ç–∞–º–∏
    for i in users_info[user]['loc'][position]['exchange']:
        # –ø—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —É –Ω–∞—Å –µ—Å—Ç—å –Ω—É–∂–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç –¥–ª—è –æ–±–º–µ–Ω–∞ –∏–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∫–æ–ª-–≤–æ –º–æ–Ω–µ—Ç
        if i in users_info[user]['items'] or (i.startswith('–∑–æ–ª–æ—Ç–æ: ') and users_info[user]['–∑–æ–ª–æ—Ç–æ'] >= int(i.replace('–∑–æ–ª–æ—Ç–æ: ', ''))):
            # –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç –æ–±–º–µ–Ω–∞
            key_txt = f'üëâ–û–±–º–µ–Ω—è—Ç—å –ø—Ä–µ–¥–º–µ—Ç {i} –Ω–∞ {users_info[user]['loc'][position]['exchange'][i]} ü§ù'
            key_data = 'exchange ' + i
            keyboard.add(telebot.types.InlineKeyboardButton(text=key_txt,callback_data=key_data))
    return (txt,keyboard)
@bot.message_handler(commands=list(comands.keys()))
def my_game(message):
    global users_info
    if message.text == '/help':
        info = ''
        for key,value in comands.items():
            info += f'/{key} - {value} \n'
        bot.send_message(message.chat.id,info)
    elif message.text == '/game':
        users_info[message.from_user.username] = {'cur_pos': '1', '–∑–æ–ª–æ—Ç–æ': 0, 'items': [], 'loc': copy.deepcopy(locations)}
        txt, keyboard = generate_story(message.from_user.username,users_info[message.from_user.username]['cur_pos'])
        bot.send_message(message.chat.id,txt,reply_markup=keyboard)
    elif message.text == '/save':
        with open(f'{message.from_user.id}_gr5.json','w',encoding='utf-8') as f:
            json.dump(users_info[message.from_user.username],f,indent=2,ensure_ascii=False)
    elif message.text == '/load':
        try:
            with open(f'{message.from_user.id}_gr5.json','r',encoding='utf-8') as f:
                users_info[message.from_user.username] = json.load(f)
            txt, keyboard = generate_story(message.from_user.username,users_info[message.from_user.username]['cur_pos'])
            bot.send_message(message.chat.id,txt,reply_markup=keyboard)
        except Exception as exc:
            bot.send_message(message.chat.id,f'(–æ—à–∏–±–∫–∞ {exc}). –ü–æ–ø—Ä–æ–±—É–π –Ω–∞—á–∞—Ç—å –Ω–æ–≤—É—é –∏–≥—Ä—É –≤–≤–µ–¥—è –∫–æ–º–∞–Ω–¥—É /game.')
    elif message.text == '/items':
        all_items = (',').join(users_info[message.from_user.username]['items'])
        txt, keyboard = generate_story(message.from_user.username,users_info[message.from_user.username]['cur_pos'])
        bot.send_message(message.chat.id,f'–í–∞—à–µ –∑–æ–ª–æ—Ç–æ: {users_info[message.from_user.username]['–∑–æ–ª–æ—Ç–æ']}')
        bot.send_message(message.chat.id,f'–í–∞—à–∏ –ø—Ä–µ–¥–º–µ—Ç—ã: {all_items}',reply_markup=keyboard)
@bot.callback_query_handler(func=lambda call: call.data in locations)
def callback_query(call):
    users_info[call.from_user.username]['cur_pos'] = call.data
    txt, keyboard = generate_story(call.from_user.username,users_info[call.from_user.username]['cur_pos'])
    bot.send_message(call.message.chat.id,txt,reply_markup=keyboard)
@bot.callback_query_handler(func=lambda call: call.data == 'new_game')
def callback_query(call):
    users_info[call.from_user.username] = {'cur_pos': '1', '–∑–æ–ª–æ—Ç–æ': 0, 'items': [], 'loc': copy.deepcopy(locations)}
    txt, keyboard = generate_story(call.from_user.username,users_info[call.from_user.username]['cur_pos'])
    bot.send_message(call.message.chat.id,txt,reply_markup=keyboard)
@bot.callback_query_handler(func = lambda call: call.data.startswith('item '))
def callback_query(call):
    # –±–µ—Ä–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞ (–≤ —Å—Ç—Ä–æ–∫–µ –∑–∞–º–µ–Ω—è–µ–º –ø–æ–¥—Å—Ç—Ä–æ–∫—É 'item', –Ω–∞ '')
    item = call.data.replace('item ','')
    if item.startswith('–∑–æ–ª–æ—Ç–æ: '):
        # —Ç–æ –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –Ω–∞ –±–∞–ª–∞–Ω—Å —ç—Ç–æ –∫–æ–ª-–≤–æ –º–æ–Ω–µ—Ç
        emoji = 'üíµ'
        users_info[call.from_user.username]['–∑–æ–ª–æ—Ç–æ'] += int(item.replace('–∑–æ–ª–æ—Ç–æ: ', ''))
    else:
        emoji = 'üì¶'
        # –∏–Ω–∞—á–µ –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–ª—è–µ–º –≤ —Å–ø–∏—Å–æ–∫ –ø—Ä–µ–¥–º–µ—Ç–æ–≤
        users_info[call.from_user.username]['items'].append(item)
    # —É–¥–∞–ª—è–µ–º —Å –∫–∞—Ä—Ç—ã –ª–æ–∫–∞—Ü–∏–∏ —ç—Ç–æ—Ç –ø—Ä–µ–¥–º–µ—Ç
    users_info[call.from_user.username]['loc'][users_info[call.from_user.username]['cur_pos']]['items'].remove(item)
    if item == '—Ç–µ—Ç—Ä–∞–¥—å –ø–æ –∞–ª–≥–µ–±—Ä–µ':
        bot.answer_callback_query(call.id,'–í—ã –ø–æ–≥–∏–±–ª–∏')
        bot.send_message(call.message.chat.id,'–ü–æ–∑–∞—Ä–∏–ª–∏—Å—å —Å–ø–∏—Å–∞—Ç—å –î–ó? –ù–µ —Ç—É—Ç —Ç–æ –±—ã–ª–æ...–í —Ç–µ—Ç—Ä–∞–¥–∏ –ø—Ä–∏–≥—Ä–µ–ª–∞—Å—å –∑–º–µ—è, –∫–æ—Ç–æ—Ä–∞—è –Ω–∞–ø—É–≥–∞–ª–∞—Å—å –∏ —É–∂–∞–ª–∏–ª–∞ –≤–∞—Å. –¢–µ–ø–µ—Ä—å –≤—ã –º–µ—Ä—Ç–≤—ã',reply_markup=key_death)
    # —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —É–¥–∞—á–Ω–æ–º –¥–µ–π—Å—Ç–≤–∏–∏
    elif item == '—Ñ–ª—è–≥–∞':
        bot.answer_callback_query(call.id,'–í—ã –ø–æ–≥–∏–±–ª–∏')
        bot.send_message(call.message.chat.id,'–í–æ —Ñ–ª—è–≥–µ –æ—Å—Ç–∞–≤–∞–ª–æ—Å—å –µ—â—ë "–æ–≥–Ω–µ–Ω–Ω–∞—è –≤–æ–¥–∞". –í—Ä–æ–¥–µ–±—ã, –º–∞–ª–æ, –Ω–æ –Ω–∞ –ø—É—Å—Ç–æ–π –∂–µ–ª—É–¥–æ–∫ —É–∂–∞—Å–Ω–∞—è —Å–º–µ—Å—å. –í—ã —É–ø–∞–ª–∏ –≤ –ª—É–∂—É, –∏ –ø–æ–≥–∏–±–ª–∏ –∑–∞—Ö–ª–µ–±–Ω—É–≤—à–∏—Å—å. –ê –≤–µ–¥—å –º–∏–Ω–∑–¥—Ä–∞–≤ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–ª...',reply_markup=key_death)
    else:
        if item == '–∫–∏—Ä–∫–∞':
            bot.answer_callback_query(call.id,f'–Ø –∫–∞–º–µ–Ω—â–∏–∫ —Ä–∞–±–æ—Ç–∞—é 3 –¥–Ω—è –±–µ–∑ –∑–∞—Ä–ø–ª–∞—Ç—ã')
        elif item == '—Å–∞–ø–æ–≥':
            bot.answer_callback_query(call.id,f'–ù—É –∏ –≤–æ–Ω—å –∏–∑ —ç—Ç–∏—Ö —Ç–∞–ø–æ–∫...')
        elif item == '–ø–µ—Ä—Å—Ç–µ–Ω—å':
            bot.answer_callback_query(call.id,'–ì—Ä–∞–≤–∏—Ä–æ–≤–∫–∞ –Ω–∞ –ø–µ—Ä—Å—Ç–Ω–µ: "–ö–æ—Ä–æ–ª—å"')
            loc_text = '''–í —Ç—ë–º–Ω–æ–º –ª–µ—Å—É, –≥–¥–µ –¥–µ—Ä–µ–≤—å—è —Å—Ç–æ—è–ª–∏ –ø–ª–æ—Ç–Ω–æ–π —Å—Ç–µ–Ω–æ–π, –∞ –∑–µ–º–ª—è –±—ã–ª–∞ –ø–æ–∫—Ä—ã—Ç–∞ –º—Ö–æ–º, –Ω–∞ –ø—É—Ç–Ω–∏–∫–∞ –Ω–∞–ø–∞–ª –æ—Ç—Ä—è–¥ —Ä–∞–∑–±–æ–π–Ω–∏–∫–æ–≤. –û–Ω–∏ –±—ã–ª–∏ –≤–æ–æ—Ä—É–∂–µ–Ω—ã –º–µ—á–∞–º–∏ –∏ –ª—É–∫–∞–º–∏, –∏—Ö –ª–∏—Ü–∞ –±—ã–ª–∏ —Å–∫—Ä—ã—Ç—ã –∫–∞–ø—é—à–æ–Ω–∞–º–∏.
–ü—É—Ç–Ω–∏–∫, –∑–∞–º–µ—Ç–∏–≤ —Ä–∞–∑–±–æ–π–Ω–∏–∫–æ–≤, –ø–æ–ø—ã—Ç–∞–ª—Å—è —É–±–µ–∂–∞—Ç—å, –Ω–æ –æ–Ω–∏ –±—ã—Å—Ç—Ä–æ –Ω–∞—Å—Ç–∏–≥–ª–∏ –µ–≥–æ. –û–¥–∏–Ω –∏–∑ —Ä–∞–∑–±–æ–π–Ω–∏–∫–æ–≤ —Å—Ö–≤–∞—Ç–∏–ª –ø—É—Ç–Ω–∏–∫–∞ –∑–∞ —Ä—É–∫—É –∏ —Å–æ—Ä–≤–∞–ª —Å –ø–∞–ª—å—Ü–∞ –ø–µ—Ä—Å—Ç–µ–Ω—å.
–û–¥–Ω–∞–∫–æ, –∫–æ–≥–¥–∞ —Ä–∞–∑–±–æ–π–Ω–∏–∫ –≤–∑–≥–ª—è–Ω—É–ª –Ω–∞ –ø–µ—Ä—Å—Ç–µ–Ω—å, –µ–≥–æ –≥–ª–∞–∑–∞ —Ä–∞—Å—à–∏—Ä–∏–ª–∏—Å—å –æ—Ç —É–¥–∏–≤–ª–µ–Ω–∏—è. –ù–∞ –ø–µ—Ä—Å—Ç–Ω–µ –±—ã–ª–∞ –≥—Ä–∞–≤–∏—Ä–æ–≤–∫–∞ ¬´–ö–æ—Ä–æ–ª—å¬ª. –†–∞–∑–±–æ–π–Ω–∏–∫–∏, —É–≤–∏–¥–µ–≤ —ç—Ç—É –Ω–∞–¥–ø–∏—Å—å, –∏—Å–ø—É–≥–∞–ª–∏—Å—å –∏ –æ—Ç—Å—Ç—É–ø–∏–ª–∏.
–ü—É—Ç–Ω–∏–∫, –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞–≤—à–∏—Å—å –º–æ–º–µ–Ω—Ç–æ–º, –≤—ã—Ä–≤–∞–ª—Å—è –∏–∑ –∏—Ö —Ä—É–∫ –∏ –ø–æ–±–µ–∂–∞–ª –¥–∞–ª—å—à–µ –≤ –ª–µ—Å. –†–∞–∑–±–æ–π–Ω–∏–∫–∏ –æ—Å—Ç–∞–ª–∏—Å—å —Å—Ç–æ—è—Ç—å –Ω–∞ –º–µ—Å—Ç–µ, –Ω–µ —Ä–µ—à–∞—è—Å—å –ø—Ä–µ—Å–ª–µ–¥–æ–≤–∞—Ç—å –µ–≥–æ.'''
            users_info[call.from_user.username]['loc']['3'] = {
            'text': loc_text, 'items': [], 'next_move': {}, 'exchange': {'–ø–µ—Ä—Å—Ç–µ–Ω—å': "–≤—ã—Ö–æ–¥"}
            }
            bot.send_photo(call.message.chat.id,'https://avatars.dzeninfra.ru/get-zen_doc/271828/pub_663a9dea9f669c30c357f34f_663a9e7d8f0f1a1233727a79/scale_1200')
        txt, keyboard = generate_story(call.from_user.username,users_info[call.from_user.username]['cur_pos'])
        bot.send_message(call.message.chat.id,f'–ì–æ—Ç–æ–≤–æ! {emoji}')
        bot.send_message(call.message.chat.id,txt,reply_markup=keyboard)
@bot.callback_query_handler(func = lambda call: call.data.startswith('exchange '))
def callback_query(call):
    item1 = call.data.replace('exchange ', '')# —á—Ç–æ —Ö–æ—Ç—è—Ç –∑–∞ –æ–±–º–µ–Ω
    item2 = users_info[call.from_user.username]['loc'][users_info[call.from_user.username]['cur_pos']]['exchange'][item1] #—á—Ç–æ –¥–∞–¥—É—Ç –ø—Ä–∏ –æ–±–º–µ–Ω–µ
    # –ï—Å–ª–∏ item1 –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –∑–æ–ª–æ—Ç–æ:
    if item1.startswith('–∑–æ–ª–æ—Ç–æ: '):
        #–£–º–µ–Ω—å—à–µ–º –∫–æ–ª-–≤–æ –º–æ–Ω–µ—Ç. –ü—Ä–æ–≤–µ—Ä–∫—É –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç–∏ –Ω–µ –ø—Ä–æ–≤–æ–¥–∏–º, –æ–Ω–∞ –≤—à–∏—Ç–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫–Ω–æ–ø–∫–∏
        users_info[call.from_user.username]['–∑–æ–ª–æ—Ç–æ'] -= int(item1.replace('–∑–æ–ª–æ—Ç–æ: ', ''))
    else:
        users_info[call.from_user.username]['items'].remove(item1)
    # –ï—Å–ª–∏ –º—ã –º–µ–Ω—è–µ–º –Ω–∞ –∑–æ–ª—Ç–æ
    if item2.startswith('–∑–æ–ª–æ—Ç–æ: '):
        #—É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –±–∞–ª–∞–Ω—Å
        users_info[call.from_user.username]['–∑–æ–ª–æ—Ç–æ'] += int(item2.replace('–∑–æ–ª–æ—Ç–æ: ', ''))
    else:
        # –∏–Ω–∞—á–µ –¥–æ–±–∞–≤–ª—è–µ–º –Ω–∞–º –ø—Ä–µ–¥–º–µ—Ç
        users_info[call.from_user.username]['items'].append(item2)
    users_info[call.from_user.username]['loc'][users_info[call.from_user.username]['cur_pos']]['exchange'].pop(item1)
    # –µ—Å–ª–∏ –º—ã –æ–±–º–µ–Ω—è–ª–∏—Å—å –Ω–∞ –≤—ã—Ö–æ–¥, —Ç–æ –≤—ã—Ö–æ–¥–∏–º –∏ —Å–æ–æ–±—â–∞–µ–º –æ –ø–æ–±–µ–¥–µ
    if item2 == '–≤—ã—Ö–æ–¥':
        bot.answer_callback_query(call.id,'–ü–û–ë–ï–î–ê!!!')
        bot.send_message(call.message.chat.id,f'üçûüçïü•™ü•ôüåÆüçî @{call.from_user.username}! –¢–µ–±–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–π—Ç–∏ –∫–≤–µ—Å—Ç!üçûüçïü•™ü•ôüåÆüçî')
        bot.send_photo(call.message.chat.id,'https://cdn.shopify.com/s/files/1/0884/4668/files/Dollarphotoclub_90793952.jpg?3721008843865200259')
    elif item2 == '–≤—Ö–æ–¥':
        bot.answer_callback_query(call.id,'–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Ö–∏–∂–∏–Ω—É —Ä–∞–∑–±–æ–π–Ω–∏–∫–æ–≤')
        users_info[call.from_user.username]['loc']['9']['next_move'] = {'–í–µ—Ä–Ω—É—Ç—å—Å—è': "8", "–í–æ–π—Ç–∏ –≤–Ω—É—Ç—Ä—å": "10"}
        users_info[call.from_user.username]['loc']['4']['next_move']['–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –¥–∏–∫—É—é —Ç—Ä–æ–ø—É'] = "12"
        txt, keyboard = generate_story(call.from_user.username,users_info[call.from_user.username]['cur_pos'])
        bot.send_photo(call.message.chat.id,'https://pro-dachnikov.com/uploads/posts/2023-01/1673091824_pro-dachnikov-com-p-foto-tainoi-dveri-28.jpg',reply_markup=keyboard)
    elif item2 == '–∑–∞–≥–∞–¥–∫–∏':
        bot.register_next_step_handler(call,zagadki)
    else:
        # —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É–¥–∞—á–Ω–æ–º –¥–µ–π—Å—Ç–≤–∏–∏
        bot.answer_callback_query(call.id,'–û–±–º–µ–Ω –∑–∞–≤–µ—Ä—à—ë–Ω')
        bot.send_message(call.message.chat.id,f'–ü–æ–ª—É—á–µ–Ω–æ {item2}')
        txt, keyboard = generate_story(call.from_user.username,users_info[call.from_user.username]['cur_pos'])
        bot.send_message(call.message.chat.id,txt,reply_markup=keyboard)
@bot.callback_query_handler(func = lambda call: call.data.startswith('–∑–∞–≥–∞–¥–∫–∏ '))
def game_babayaga(call):
    zagadka = random.choice(list(zagadki.keys()))
    if '–ª–∏—Å—Ç–æ–∫ —Å –ø–æ–¥—Å–∫–∞–∑–∫–∞–º–∏' in users_info[call.from_user.username]['items']:
        bot.send_message(call.message.chat.id,zagadka)
if __name__ == '__main__':
    bot.infinity_polling()